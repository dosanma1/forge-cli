{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://forge.dev/schemas/v1.0/config.json",
  "title": "Forge Configuration",
  "description": "Configuration file for Forge framework workspaces",
  "type": "object",
  "required": ["version", "workspace", "projects"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Configuration schema version",
      "const": "1",
      "examples": ["1"]
    },
    "workspace": {
      "type": "object",
      "description": "Workspace-level configuration",
      "required": ["name", "forgeVersion"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Workspace name (must be kebab-case)",
          "pattern": "^[a-z][a-z0-9-]*$",
          "minLength": 1,
          "maxLength": 63,
          "examples": ["my-project", "api-gateway"]
        },
        "forgeVersion": {
          "type": "string",
          "description": "Forge framework version (semver)",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "examples": ["1.0.0", "1.2.3"]
        },
        "github": {
          "type": "object",
          "description": "GitHub organization configuration",
          "properties": {
            "org": {
              "type": "string",
              "description": "GitHub organization name",
              "examples": ["mycompany", "acme-corp"]
            }
          },
          "required": ["org"]
        },
        "docker": {
          "type": "object",
          "description": "Docker registry configuration (deprecated - use build.registry)",
          "properties": {
            "registry": {
              "type": "string",
              "description": "Docker registry URL",
              "examples": ["gcr.io/my-project", "us-central1-docker.pkg.dev/my-project/repo"]
            }
          }
        },
        "gcp": {
          "type": "object",
          "description": "Google Cloud Platform configuration",
          "properties": {
            "projectId": {
              "type": "string",
              "description": "GCP project ID",
              "examples": ["my-project-123456"]
            },
            "region": {
              "type": "string",
              "description": "Default GCP region",
              "examples": ["us-central1", "europe-west1"]
            }
          }
        },
        "kubernetes": {
          "type": "object",
          "description": "Generic Kubernetes configuration (deprecated - use infrastructure.kubernetes)",
          "properties": {
            "namespace": {
              "type": "string",
              "description": "Default Kubernetes namespace",
              "examples": ["default", "production"]
            },
            "context": {
              "type": "string",
              "description": "Kubeconfig context name",
              "examples": ["kind-my-cluster", "gke_my-project_us-central1_my-cluster"]
            }
          }
        }
      }
    },
    "projects": {
      "type": "object",
      "description": "Projects in the workspace",
      "additionalProperties": {
        "type": "object",
        "required": ["name", "type", "root"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Project name (must be kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "examples": ["api-server", "user-service", "web-app"]
          },
          "type": {
            "type": "string",
            "description": "Project type",
            "enum": ["go-service", "angular-app", "shared-lib", "typescript-lib"],
            "examples": ["go-service", "angular-app"]
          },
          "root": {
            "type": "string",
            "description": "Relative path to project root",
            "examples": ["backend/services/api-server", "frontend/projects/web-app"]
          },
          "tags": {
            "type": "array",
            "description": "Tags for categorizing projects",
            "items": {
              "type": "string"
            },
            "examples": [["backend", "service"], ["frontend", "angular"]]
          },
          "port": {
            "type": "integer",
            "description": "Default port for the service",
            "minimum": 1024,
            "maximum": 65535,
            "examples": [8080, 4200]
          },
          "environments": {
            "type": "object",
            "description": "Per-project environment overrides",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "replicas": {
                  "type": "integer",
                  "description": "Number of replicas",
                  "minimum": 0,
                  "examples": [1, 3, 5]
                },
                "resources": {
                  "type": "object",
                  "description": "Resource limits and requests",
                  "properties": {
                    "memory": {
                      "type": "string",
                      "description": "Memory limit (e.g., 128Mi, 1Gi)",
                      "examples": ["128Mi", "512Mi", "1Gi"]
                    },
                    "cpu": {
                      "type": "string",
                      "description": "CPU limit (e.g., 100m, 1)",
                      "examples": ["100m", "500m", "2"]
                    }
                  }
                },
                "variables": {
                  "type": "object",
                  "description": "Environment-specific variables",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                "deploymentTarget": {
                  "type": "string",
                  "description": "Override workspace-level deployment target",
                  "enum": ["gke", "kubernetes", "cloudrun"],
                  "examples": ["gke", "cloudrun"]
                }
              }
            }
          }
        }
      }
    },
    "build": {
      "type": "object",
      "description": "Build system configuration",
      "properties": {
        "goVersion": {
          "type": "string",
          "description": "Go version",
          "examples": ["1.23", "1.24.4"]
        },
        "nodeVersion": {
          "type": "string",
          "description": "Node.js version",
          "examples": ["20.18.1", "22.0.0"]
        },
        "registry": {
          "type": "string",
          "description": "Default Docker registry for images",
          "examples": ["gcr.io/my-project", "us-central1-docker.pkg.dev/my-project/repo"]
        },
        "cache": {
          "type": "object",
          "description": "Build cache configuration",
          "properties": {
            "remoteUrl": {
              "type": "string",
              "description": "Remote Bazel cache URL (e.g., GCS bucket)",
              "examples": ["gs://my-project-bazel-cache", "grpc://cache.example.com:9092"]
            }
          }
        },
        "parallel": {
          "type": "object",
          "description": "Parallel build configuration",
          "properties": {
            "workers": {
              "type": "integer",
              "description": "Number of parallel build workers (0 = auto-detect)",
              "minimum": 0,
              "examples": [0, 4, 8]
            }
          }
        }
      }
    },
    "environments": {
      "type": "object",
      "description": "Deployment environments",
      "additionalProperties": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Environment name",
            "examples": ["local", "dev", "staging", "prod"]
          },
          "target": {
            "type": "string",
            "description": "Deployment target platform",
            "enum": ["gke", "kubernetes", "cloudrun"],
            "default": "kubernetes",
            "examples": ["gke", "cloudrun"]
          },
          "profile": {
            "type": "string",
            "description": "Skaffold profile name",
            "examples": ["dev", "staging", "prod"]
          },
          "cluster": {
            "type": "string",
            "description": "Kubernetes/GKE cluster name",
            "examples": ["kind-my-project", "my-gke-cluster"]
          },
          "namespace": {
            "type": "string",
            "description": "Kubernetes namespace",
            "examples": ["default", "dev", "production"]
          },
          "registry": {
            "type": "string",
            "description": "Environment-specific Docker registry",
            "examples": ["gcr.io/my-project-dev", "gcr.io/my-project-prod"]
          },
          "region": {
            "type": "string",
            "description": "Cloud region (for GKE or Cloud Run)",
            "examples": ["us-central1", "europe-west1"]
          },
          "description": {
            "type": "string",
            "description": "Environment description",
            "examples": ["Local development", "Production environment"]
          },
          "variables": {
            "type": "object",
            "description": "Environment-wide variables",
            "additionalProperties": {
              "type": "string"
            }
          }
        }
      }
    },
    "infrastructure": {
      "type": "object",
      "description": "Infrastructure configuration by vendor",
      "properties": {
        "gke": {
          "type": "object",
          "description": "Google Kubernetes Engine (GKE) configuration",
          "properties": {
            "projectId": {
              "type": "string",
              "description": "GCP project ID",
              "examples": ["my-project-123456"]
            },
            "clusterName": {
              "type": "string",
              "description": "GKE cluster name",
              "examples": ["my-cluster", "production-cluster"]
            },
            "region": {
              "type": "string",
              "description": "GKE cluster region (use region for regional clusters)",
              "examples": ["us-central1", "europe-west1"]
            },
            "namespace": {
              "type": "string",
              "description": "Default Kubernetes namespace",
              "examples": ["default", "production"]
            },
            "workloadIdentityProvider": {
              "type": "string",
              "description": "Workload Identity provider for CI/CD",
              "examples": ["projects/123456/locations/global/workloadIdentityPools/github-pool/providers/github-provider"]
            },
            "serviceAccount": {
              "type": "string",
              "description": "Service account email for Workload Identity",
              "examples": ["github-actions@my-project.iam.gserviceaccount.com"]
            }
          }
        },
        "kubernetes": {
          "type": "object",
          "description": "Generic Kubernetes configuration (non-cloud provider)",
          "properties": {
            "cluster": {
              "type": "string",
              "description": "Cluster name",
              "examples": ["kind-my-cluster", "minikube"]
            },
            "namespace": {
              "type": "string",
              "description": "Default namespace",
              "examples": ["default"]
            },
            "context": {
              "type": "string",
              "description": "Kubeconfig context",
              "examples": ["kind-my-cluster"]
            }
          }
        },
        "cloudrun": {
          "type": "object",
          "description": "Google Cloud Run configuration",
          "properties": {
            "region": {
              "type": "string",
              "description": "Cloud Run region",
              "examples": ["us-central1", "europe-west1"]
            },
            "project": {
              "type": "string",
              "description": "GCP project ID",
              "examples": ["my-project-123456"]
            }
          }
        },
        "deploymentTarget": {
          "type": "string",
          "description": "Default deployment target for all environments",
          "enum": ["gke", "kubernetes", "cloudrun", "both"],
          "examples": ["gke", "kubernetes"]
        }
      }
    }
  }
}
