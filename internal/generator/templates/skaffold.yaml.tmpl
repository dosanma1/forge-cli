# Code generated by forge-cli. DO NOT EDIT.
# Regenerate with: forge generate

apiVersion: skaffold/v4beta11
kind: Config
metadata:
  name: {{.ProjectName}}-microservices

# FORGE-REQUIRES-START
requires:
{{range .Services}}
  - path: backend/services/{{.Name}}
{{end}}
{{if .HasAPIGateway}}
  - path: infra/api-gateway
{{end}}
# FORGE-REQUIRES-END

build:
  platforms:
    - linux/amd64
    - linux/arm64
  local:
    push: false
    useDockerCLI: true
    useBuildkit: true
    concurrency: 0
  tagPolicy:
    gitCommit:
      variant: AbbrevCommitSha

profiles:
  - name: local
    activation:
      - kubeContext: kind-{{.ProjectName}}
    build:
      platforms:
        - linux/arm64
      local:
        push: false
  
  - name: dev
    build:
      local:
        push: true
    deploy:
      helm:
        releases:
          {{range .Services}}
          - name: {{.Name}}
            chartPath: infra/helm/service
            namespace: dev
            setValues:
              service.name: {{.Name}}
              image.repository: {{$.Registry}}/{{.Name}}
          {{end}}

  - name: prod
    build:
      local:
        push: true
    deploy:
      helm:
        releases:
          {{range .Services}}
          - name: {{.Name}}
            chartPath: infra/helm/service
            namespace: prod
            setValues:
              service.name: {{.Name}}
              image.repository: {{$.Registry}}/{{.Name}}
          {{end}}
